{{define "title"}}Admin{{end}}

{{define "content"}}
<div class="dash-grid">
    <div class="dash-stats">
        <div class="dash-stat">
            <span class="dash-stat-label">Active links</span>
            <span class="dash-stat-number mono">{{formatNum .TotalLinks}}</span>
        </div>
        <div class="dash-stat">
            <span class="dash-stat-label">Today</span>
            <span class="dash-stat-number mono">{{formatNum .ClicksToday}}</span>
        </div>
        <div class="dash-stat">
            <span class="dash-stat-label">Total clicks</span>
            <span class="dash-stat-number mono">{{formatNum .ClicksAllTime}}</span>
        </div>
    </div>
    <div class="dash-referrers">
        <div class="dash-tabs">
            <button class="dash-tab active" data-tab="referrers">Referrers</button>
            <button class="dash-tab" data-tab="countries">Countries</button>
            <button class="dash-tab" data-tab="browsers">Browsers</button>
            <button class="dash-tab" data-tab="devices">Devices</button>
        </div>
        <div class="dash-tab-panel active" data-panel="referrers">
            {{if .TopReferrers}}
            <div class="al-rows">
                {{range .TopReferrers}}
                <div class="al-row">
                    <span class="al-row-label mono">{{.Domain}}</span>
                    <span class="al-row-count mono">{{formatNum .Count}}</span>
                </div>
                {{end}}
            </div>
            {{else}}
            <p class="empty-state">No referrer data yet.</p>
            {{end}}
        </div>
        <div class="dash-tab-panel" data-panel="countries">
            {{if .TopCountries}}
            <div class="al-rows">
                {{range .TopCountries}}
                <div class="al-row">
                    <span class="al-row-label">{{countryFlag .Country}} {{.Country}}</span>
                    <span class="al-row-count mono">{{formatNum .Count}}</span>
                </div>
                {{end}}
            </div>
            {{else}}
            <p class="empty-state">No country data yet.</p>
            {{end}}
        </div>
        <div class="dash-tab-panel" data-panel="browsers">
            {{if .TopBrowsers}}
            <div class="al-rows">
                {{range .TopBrowsers}}
                <div class="al-row">
                    <span class="al-row-label">{{.Browser}}</span>
                    <span class="al-row-count mono">{{formatNum .Count}}</span>
                </div>
                {{end}}
            </div>
            {{else}}
            <p class="empty-state">No browser data yet.</p>
            {{end}}
        </div>
        <div class="dash-tab-panel" data-panel="devices">
            {{if .TopDevices}}
            <div class="al-rows">
                {{range .TopDevices}}
                <div class="al-row">
                    <span class="al-row-label">{{title .DeviceType}}</span>
                    <span class="al-row-count mono">{{formatNum .Count}}</span>
                </div>
                {{end}}
            </div>
            {{else}}
            <p class="empty-state">No device data yet.</p>
            {{end}}
        </div>
    </div>
</div>

<div class="search-bar">
    <input
        type="search"
        name="search"
        class="input search-input"
        placeholder="Search links..."
        value="{{.Search}}"
        hx-get="/admin"
        hx-trigger="input changed delay:300ms, search"
        hx-target="#link-cards"
        hx-push-url="true"
        hx-include="this"
    >
</div>

<div id="link-cards">
    {{template "cards" .}}
</div>

<script>
// Dashboard tabs
(function() {
    document.querySelectorAll('.dash-tab').forEach(function(tab) {
        tab.addEventListener('click', function() {
            var target = tab.getAttribute('data-tab');
            var container = tab.closest('.dash-referrers');
            container.querySelectorAll('.dash-tab').forEach(function(t) { t.classList.remove('active'); });
            container.querySelectorAll('.dash-tab-panel').forEach(function(p) { p.classList.remove('active'); });
            tab.classList.add('active');
            container.querySelector('[data-panel="' + target + '"]').classList.add('active');
        });
    });
})();

// Copy short URL
(function() {
    document.addEventListener('click', function(e) {
        var btn = e.target.closest('.btn-copy');
        if (!btn) return;
        var url = btn.getAttribute('data-url');
        navigator.clipboard.writeText(url).then(function() {
            btn.classList.add('copied');
            setTimeout(function() { btn.classList.remove('copied'); }, 1500);
        });
    });
})();
</script>
{{end}}
