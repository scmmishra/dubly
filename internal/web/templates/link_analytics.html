{{define "title"}}{{.Link.ShortURL}}{{end}}

{{define "content"}}
{{if not .Link.IsActive}}
<div class="flash flash-error">This link is inactive and returns HTTP 410 (Gone).</div>
{{end}}

<a href="/admin" class="al-back">&larr; Back</a>

<div class="al-header">
    <div class="al-header-left">
        <h1 class="al-url mono">{{.Link.ShortURL}}</h1>
        <a href="{{.Link.Destination}}" target="_blank" rel="noopener" class="al-dest mono">{{truncate .Link.Destination 70}}</a>
        {{if .Link.Title}}<p class="al-link-title">{{.Link.Title}}</p>{{end}}
    </div>
    <div class="al-header-right">
        <a href="{{.Link.ShortURL}}" target="_blank" rel="noopener" class="btn btn-ghost">Visit</a>
        <a href="/admin/links/{{.Link.ID}}/edit" class="btn btn-primary">Edit</a>
    </div>
</div>

<div class="al-hero">
    <div class="al-hero-stat">
        <span class="al-hero-number mono">{{formatNum .TotalClicks}}</span>
        <span class="al-hero-label">Total clicks</span>
    </div>
    <div class="al-hero-stat">
        <span class="al-hero-number mono">{{formatNum .ClicksToday}}</span>
        <span class="al-hero-label">Today</span>
    </div>
    <div class="al-hero-stat">
        <span class="al-hero-number mono">{{formatNum .ClicksThisWeek}}</span>
        <span class="al-hero-label">This week{{if gt .ClicksPrevWeek 0}} <span class="al-hero-change {{if .WeekChangeUp}}al-change-up{{else}}al-change-down{{end}}">{{if .WeekChangeUp}}+{{end}}{{.WeekChange}}%</span>{{end}}</span>
    </div>
</div>

<div class="al-meta">
    <span class="al-meta-item">Created {{timeAgo .Link.CreatedAt}}</span>
    {{if .Link.Tags}}<span class="al-meta-item al-meta-has-dot">{{spaceTags .Link.Tags}}</span>{{end}}
</div>

<div class="al-grid">
    <div class="card al-breakdown">
        <h2 class="card-title">Top referrers</h2>
        {{if .TopReferrers}}
        <div class="al-rows">
            {{range .TopReferrers}}
            <div class="al-row">
                <span class="al-row-label mono">{{.Domain}}</span>
                <span class="al-row-count mono">{{formatNum .Count}}</span>
            </div>
            {{end}}
        </div>
        {{else}}
        <p class="empty-state">No referrer data yet.</p>
        {{end}}
    </div>

    <div class="card al-breakdown">
        <h2 class="card-title">Top countries</h2>
        {{if .TopCountries}}
        <div class="al-rows">
            {{range .TopCountries}}
            <div class="al-row">
                <span class="al-row-label">{{countryFlag .Country}} {{.Country}}</span>
                <span class="al-row-count mono">{{formatNum .Count}}</span>
            </div>
            {{end}}
        </div>
        {{else}}
        <p class="empty-state">No country data yet.</p>
        {{end}}
    </div>

    <div class="card al-breakdown">
        <h2 class="card-title">Top browsers</h2>
        {{if .TopBrowsers}}
        <div class="al-rows">
            {{range .TopBrowsers}}
            <div class="al-row">
                <span class="al-row-label">{{.Browser}}</span>
                <span class="al-row-count mono">{{formatNum .Count}}</span>
            </div>
            {{end}}
        </div>
        {{else}}
        <p class="empty-state">No browser data yet.</p>
        {{end}}
    </div>

    <div class="card al-breakdown">
        <h2 class="card-title">Devices</h2>
        {{if .TopDevices}}
        <div class="al-rows">
            {{range .TopDevices}}
            <div class="al-row">
                <span class="al-row-label">{{title .DeviceType}}</span>
                <span class="al-row-count mono">{{formatNum .Count}}</span>
            </div>
            {{end}}
        </div>
        {{else}}
        <p class="empty-state">No device data yet.</p>
        {{end}}
    </div>
</div>
{{end}}
